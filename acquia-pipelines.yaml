version: 1.0.0

events:
  build:
    steps:
      - get-core:
          type: script
          script:
            # Build non-development composer packages.
            - composer install --no-interaction --no-dev --optimize-autoloader
            - 'chmod u+w docroot/sites/default/settings.php'
            - 'if [ -e "scripts/settings.php" ]; then cp scripts/settings.php docroot/sites/default/settings.php; else cp docroot/sites/default/default.settings.php docroot/sites/default/settings.php; fi'
            - 'mkdir docroot/sites/default/files'
            - 'chmod u+w docroot/sites/default/files'
      # Deploy the build artifact to a Cloud on-demand environment.
      - deploy:
          script:
            - pipelines-deploy

  # When a GitHub pull request is merged, this deletes the coresponding ODE.
  pr-merged:
    steps:
      - deploy:
          script:
            - pipelines-deploy

  # When a GitHub pull request is closed, this deletes the coresponding ODE.
  pr-closed:
    steps:
      - deploy:
          script:
            - pipelines-deploy

# add settings.php and sites/default/files
-post-build:
          type: script
          script:
